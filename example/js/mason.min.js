(function(e){e.fn.mason=function(t,n){var r={itemSelector:null,ratio:0,sizes:[],columns:[[0,480,1],[480,780,2],[780,1080,3],[1080,1320,4],[1320,1680,5]],promoted:[],filler:{itemSelector:t.itemSelector,filler_class:"mason_filler"},layout:"none",gutter:0};if(n){var i={complete:n}}var s={block:{height:0,width:0},matrix:[]};return this.each(function(){function f(){if(e(".mason_clear").length<1){a.append("<div class='mason_clear' style='clear:both;position:relative;'></div>")}s.block.height=parseFloat((a.width()/c()/o.ratio).toFixed(0));s.block.width=parseFloat(a.width()/c());l()}function l(){var t=c();if(t==1){$sel=e(o.itemSelector);$sel.height(s.block.height);$sel.width(s.block.width);$sel.css({margin:"0px"})}else{for(var n=0;n<o.promoted.length;n++){o.sizes.push([o.promoted[n][0],o.promoted[n][1]])}e(o.itemSelector).each(function(){$sel=e(this);v=Math.floor(Math.random()*(o.sizes.length-o.promoted.length));ranSize=o.sizes[v];for(var t=0;t<o.promoted.length;t++){if($sel.hasClass(o.promoted[t][2])){ranSize=[o.promoted[t][0],o.promoted[t][1]];v=o.sizes.length-1-1+t}}$sel.data("size",v);var n=parseFloat((s.block.height*ranSize[1]).toFixed(2));n=n-o.gutter*2;var r=parseFloat(s.block.width*ranSize[0]);r=r-o.gutter*2;$sel.height(n+"px");$sel.width(r+"px");$sel.css({margin:o.gutter})});var r=a.height();var i=r/s.block.height;s.matrix=[];for(var n=0;n<i;n++){s.matrix[n]=[];for(var f=0;f<t;f++){s.matrix[n][f]=false}}e(o.itemSelector).each(function(){$sel=e(this);var t=Math.round($sel.position().left/s.block.width);var n=Math.round($sel.position().top/s.block.height);var r=parseFloat($sel.data("size"));var i=o.sizes[r][1];var u=o.sizes[r][0];var a=i*u;for(var f=0;f<a;f++){for(var l=0;l<i;l++){s.matrix[n+l][t]=true;for(var c=0;c<u;c++){s.matrix[n+l][t+c]=true}}}});for(var n=0;n<s.matrix.length;n++){for(var f=0;f<s.matrix[n].length;f++){if(s.matrix[n][f]==false){var l=parseFloat(s.block.height),h=parseFloat(s.block.width);var p=parseFloat((n*l).toFixed(2))+o.gutter,d=parseFloat(f*h)+o.gutter,v,m;l=l-o.gutter*2;h=h-o.gutter*2;v=Math.floor(Math.random()*e(o.filler.itemSelector).length);m=e(o.filler.itemSelector).eq(v).clone();m.addClass(o.filler.filler_class);m.css({position:"absolute",top:p+"px",left:d+"px",height:l+"px",width:h+"px",margin:"0px"});m.appendTo(a)}}}if(u.complete!=null){u.complete()}}}function c(){var e=Math.floor(a.width()),t=0,n=o.columns.length-1;if(e>=o.columns[n][1]){t=o.columns[n][2]}else{for(var r=0;r<=n;r++){if(e>o.columns[r][0]&&e<o.columns[r][1]){t=o.columns[r][2]}}}return t}var o=e.extend(r,t);var u=e.extend(i,n);var a=e(this);var h=function(){var e={};return function(t,n,r){if(!r){r="Don't call this twice without a uniqueId"}if(e[r]){clearTimeout(e[r])}e[r]=setTimeout(t,n)}}();if(o.layout=="fluid"){e(window).resize(function(){e("."+o.filler.filler_class).remove();s.matrix=[];h(function(){e("."+o.filler.filler_class).remove();f()},150)})}f()})}})(jQuery)