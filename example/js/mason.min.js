(function(e){e.fn.mason=function(t,n){var r={itemSelector:null,ratio:0,sizes:[],columns:[[0,480,1],[480,780,2],[780,1080,3],[1080,1320,4],[1320,1680,5]],promoted:[],filler:{itemSelector:t.itemSelector,filler_class:"mason_filler"},layout:"fluid"};var i={block:{height:0,width:0},matrix:[]};return this.each(function(){function a(){if(e(".mason_clear").length<1){u.append("<div class='mason_clear' style='clear:both;position:relative;'></div>")}i.block.height=(u.width()/l()/s.ratio).toFixed(0);i.block.width=u.width()/l();f()}function f(){var t=l();if(t==1){$sel=e(s.itemSelector);$sel.height(i.block.height);$sel.width(i.block.width)}else{for(var n=0;n<s.promoted.length;n++){s.sizes.push([s.promoted[n][0],s.promoted[n][1]])}e(s.itemSelector).each(function(){$sel=e(this);d=Math.floor(Math.random()*(s.sizes.length-s.promoted.length));ranSize=s.sizes[d];for(var t=0;t<s.promoted.length;t++){if($sel.hasClass(s.promoted[t][2])){ranSize=[s.promoted[t][0],s.promoted[t][1]];d=s.sizes.length-1+t}}$sel.data("size",d);var n=(i.block.height*ranSize[1]).toFixed(2);var r=i.block.width*ranSize[0];$sel.height(n+"px");$sel.width(r+"px")});var r=u.height();var o=r/i.block.height;i.matrix=[];for(var n=0;n<o;n++){i.matrix[n]=[];for(var a=0;a<t;a++){i.matrix[n][a]=false}}e(s.itemSelector).each(function(){$sel=e(this);var t=Math.round($sel.position().left/i.block.width);var n=Math.round($sel.position().top/i.block.height);var r=parseFloat($sel.data("size"));var o=s.sizes[r][1];var u=s.sizes[r][0];var a=o*u;for(var f=0;f<a;f++){for(var l=0;l<o;l++){i.matrix[n+l][t]=true;for(var c=0;c<u;c++){i.matrix[n+l][t+c]=true}}}});for(var n=0;n<i.matrix.length;n++){for(var a=0;a<i.matrix[n].length;a++){if(i.matrix[n][a]==false){var f=i.block.height,c=i.block.width;var h=(n*f).toFixed(2),p=a*c,d,v;d=Math.floor(Math.random()*e(s.filler.itemSelector).length);v=e(s.filler.itemSelector).eq(d).clone();v.addClass(s.filler.filler_class);v.css({position:"absolute",top:h+"px",left:p+"px",height:f+"px",width:c+"px"});v.appendTo(u)}}}}}function l(){var e=Math.floor(u.width()),t=0,n=s.columns.length-1;if(e>s.columns[n][1]){t=s.columns[n][2]}else{for(var r=0;r<=n;r++){if(e>s.columns[r][0]&&e<s.columns[r][1]){t=s.columns[r][2]}}}return t}var s=e.extend(r,t);var o=e.extend(n,n);var u=e(this);var c=function(){var e={};return function(t,n,r){if(!r){r="Don't call this twice without a uniqueId"}if(e[r]){clearTimeout(e[r])}e[r]=setTimeout(t,n)}}();if(s.layout=="fluid"){e(window).resize(function(){c(function(){e("."+s.filler.filler_class).remove();a()},150)})}a()})}})(jQuery)