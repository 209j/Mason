(function(e){e.fn.mason=function(t){var n={itemSelector:null,ratio:0,sizes:[],columns:[[0,480,1],[480,780,2],[780,1080,3],[1080,1320,4],[1320,1680,5]],promoted:[],filler:{itemSelector:t.itemSelector,filler_class:"mason_filler"},layout:"none"};var r={block:{height:0,width:0},matrix:[]};return this.each(function(){function o(){if(e(".mason_clear").length<1){s.append("<div class='mason_clear' style='clear:both;position:relative;'></div>")}r.block.height=(s.width()/a()/i.ratio).toFixed(0);r.block.width=s.width()/a();u()}function u(){var t=a();if(t==1){$sel=e(i.itemSelector);$sel.height(r.block.height);$sel.width(r.block.width)}else{for(var n=0;n<i.promoted.length;n++){i.sizes.push([i.promoted[n][0],i.promoted[n][1]])}e(i.itemSelector).each(function(){$sel=e(this);d=Math.floor(Math.random()*(i.sizes.length-i.promoted.length));ranSize=i.sizes[d];for(var t=0;t<i.promoted.length;t++){if($sel.hasClass(i.promoted[t][2])){ranSize=[i.promoted[t][0],i.promoted[t][1]];d=i.sizes.length-1+t}}$sel.data("size",d);var n=(r.block.height*ranSize[1]).toFixed(2);var s=r.block.width*ranSize[0];$sel.height(n+"px");$sel.width(s+"px")});var o=s.height();var u=o/r.block.height;r.matrix=[];for(var n=0;n<u;n++){r.matrix[n]=[];for(var f=0;f<t;f++){r.matrix[n][f]=false}}e(i.itemSelector).each(function(){$sel=e(this);var t=Math.round($sel.position().left/r.block.width);var n=Math.round($sel.position().top/r.block.height);var s=parseFloat($sel.data("size"));var o=i.sizes[s][1];var u=i.sizes[s][0];var a=o*u;for(var f=0;f<a;f++){for(var l=0;l<o;l++){r.matrix[n+l][t]=true;for(var c=0;c<u;c++){r.matrix[n+l][t+c]=true}}}});for(var n=0;n<r.matrix.length;n++){for(var f=0;f<r.matrix[n].length;f++){if(r.matrix[n][f]==false){var l=r.block.height,c=r.block.width;var h=(n*l).toFixed(2),p=f*c,d,v;d=Math.floor(Math.random()*e(i.filler.itemSelector).length);v=e(i.filler.itemSelector).eq(d).clone();v.addClass(i.filler.filler_class);v.css({position:"absolute",top:h+"px",left:p+"px",height:l+"px",width:c+"px"});v.appendTo(s)}}}}}function a(){var e=Math.floor(s.width()),t=0,n=i.columns.length-1;if(e>i.columns[n][1]){t=i.columns[n][2]}else{for(var r=0;r<=n;r++){if(e>i.columns[r][0]&&e<i.columns[r][1]){t=i.columns[r][2]}}}return t}var i=e.extend(n,t);var s=e(this);var f=function(){var e={};return function(t,n,r){if(!r){r="Don't call this twice without a uniqueId"}if(e[r]){clearTimeout(e[r])}e[r]=setTimeout(t,n)}}();if(i.layout=="fluid"){e(window).resize(function(){f(function(){e("."+i.filler.filler_class).remove();o()},150)})}o()})}})(jQuery)